---
title: "Jam"
author: "Samantha Ream and Josh Jenkins"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(corrplot)
library(ggplot2)
library(dbplyr)
library(colorspace)
library(tidyr)
library(astsa)
```


```{r}
# data upload
age_consent <- read.csv("data/Age-of-Sexual-Consent.csv")
slavery_index <- read.csv("data/Global_Slavery_Index_2023.csv")
marriage <- read.csv("data/Percentage-of-Females-Married-by-15-years-old.csv")

human_trafficking <- read.csv("data/human-trafficking-victims_new.csv")

nrow(age_consent) #201
nrow(slavery_index) # 180 
nrow(marriage) #202
nrow(human_trafficking) # 364
head(human_trafficking) # 84

unique(human_trafficking$Entity)
```


```{r}
head(age_consent)
head(slavery_index)
slavery_index <- slavery_index |>
  rename(Per_1000 = Estimated.prevalence.of.modern.slavery.per.1.000.population) |>
  rename(Num_modern_slavery = Estimated.number.of.people.in.modern.slavery)

head(marriage)
marriage <- marriage |>
  rename(Percent_married_15 = Percentage.of.Females.Married.by.15.years.old) |>
  rename(Country = Countries)

head(human_trafficking)
human_trafficking <- human_trafficking |>
  rename(Detected_Number = Detected.victims.of.human.trafficking) |>
  rename(Country = Entity)

#slavery_index |> group_by(Region)
```

```{r}
slavery_index <- left_join(slavery_index, age_consent, by = "Country")

slavery_index <- left_join(slavery_index, marriage, by = "Country")

#slavery_index <- slavery_index |> mutate(across(everything(), ~replace_na(.x, NA)))

head(slavery_index)

# slavery_index <- slavery_index |>
#   mutate(Percent_married_15 = recode(Percent_married_15, - = NA))

#slavery_index[5, "Percent_married_15"]

```

```{r}
# Column Prep

slavery_index$Num_modern_slavery <- replace(slavery_index$Num_modern_slavery,
                                            slavery_index$Num_modern_slavery=="", NA)

slavery_index$Num_modern_slavery <- as.numeric(gsub(",","",slavery_index$Num_modern_slavery))

slavery_index$Population <- as.double(gsub(",","",slavery_index$Population))

slavery_index$Percent_married_15 <- as.double(replace(slavery_index$Percent_married_15, slavery_index$Percent_married_15=="-", NA))

```

```{r}
slavery_index |> group_by(Region)

unique(slavery_index$Region)


Asia_Pacific_sum <- sum(slavery_index |> filter(Region == "Asia and the Pacific") |> select("Num_modern_slavery"), na.rm = T)

Americas_sum <- sum(slavery_index |> filter(Region == "Americas") |> select("Num_modern_slavery"), na.rm = T)

Euro_Central_Asia_sum <- sum(slavery_index |> 
                               filter(Region == "Europe and Central Asia") |>
                               select("Num_modern_slavery"), na.rm = T)
Africa_sum <- sum(slavery_index |> 
                               filter(Region == "Africa") |>
                               select("Num_modern_slavery"), na.rm = T)

Arab_States_sum <- sum(slavery_index |> 
                               filter(Region == "Arab States") |>
                               select("Num_modern_slavery"), na.rm = T)

Regions <- data.frame(
  Region = c("Asia and the Pacific", 
             "Americas", "Europe and Central Asia", 
             "Africa", "Arab States"), 
  Modern_Slavery = c(Asia_Pacific_sum, 
                     Americas_sum, Euro_Central_Asia_sum, 
                     Africa_sum, Arab_States_sum)
)

(regions_graph <- Regions |> ggplot(aes(x = Region, y = Modern_Slavery)) +
  geom_col(fill = "cornflowerblue", col = "royalblue4"))
```

```{r}
aocplot <- as.double(replace(age_consent$Age.Of.Consent, age_consent$Age.Of.Consent=="Must be married", 0))

df1 <- data.frame(x = aocplot, y = 1:201)

ggplot(df1, aes(x=aocplot)) +
  geom_bar()
```

```{r}
country_max <- slavery_index[which.max(slavery_index$Per_1000), ]
country_min <- slavery_index[which.min(slavery_index$Per_1000), ]

slavery_index |> arrange(desc(Per_1000))

slavery_index |> filter(Region == "Asia and the Pacific") |> arrange(desc(Per_1000))


# population of top 20
# area for top 20


top_10 <- slavery_index |> arrange(desc(Per_1000)) |> head(n=10)
```






